define ("tool_componentlibrary/mustache",["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],function(a,b,c,d,e,f,g){var h=function(a,b){if(!a){return!1}var c="@template "+b,d=0,e=[];e=a.match(/{{!([\s\S]*?)}}/g);if(null!==e){for(d=0;d<e.length;d++){var f=e[d],g=f.indexOf(c);if(-1!==g){var h=g+c.length+1;f=f.substr(h,f.length-2-h);return f}}}return!1},i=function(b,f,i,j,k){g.get_string("templateselected","tool_templatelibrary",f).done(function(b){a("[data-region=\"displaytemplateheader\"]").text(b)}).fail(d.exception);b.find("[data-region=\"source\"]").text(i);if(!k){var l=h(i,f);if(!1===l){l=h(j,f)}if(!1===l){c.debug("Template is missing docs section.");return}var k=l.match(/Example context \(json\):([\s\S]*);?/);k=k[1].trim();b.find("[data-region=\"config\"]").text(k)}var m=!1;if(k){try{m=JSON.parse(k)}catch(a){c.debug("Could not parse json example context for template.");c.debug(k);c.debug(a)}}if(m){e.render(f,m).done(function(a,c){e.replaceNodeContents(b.find("[data-region=\"rendered\"]"),a,c)}).fail(d.exception)}else{g.get_string("templatehasnoexample","tool_templatelibrary").done(function(a){b.find("[data-region=\"rendered\"]").text(a)}).fail(d.exception)}},j=function(c,e,g){var h=e.split("/"),j=h.shift(),k=h.join("/"),l=b.call([{methodname:"core_output_load_template",args:{component:j,template:k,themename:f.theme,includecomments:!0}},{methodname:"tool_templatelibrary_load_canonical_template",args:{component:j,template:k}}],!0,!1);a.when.apply(a,l,g).done(function(a,b){i(c,e,a,b,g)}).fail(d.exception)};return{init:function init(){var b=a("[data-region=\"componentlibrary\"]");b.find("[data-region=\"mustachecode\"]").each(function(){var b=a(this).attr("data-template");j(a(this),b)});b.find("[data-region=\"mustachewithcontext\"").each(function(){var b=a(this).attr("data-template"),c=a(this).attr("data-config");j(a(this),b,c)})}}});
//# sourceMappingURL=mustache.min.js.map

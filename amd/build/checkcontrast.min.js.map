{"version":3,"sources":["../src/checkcontrast.js"],"names":["define","$","contrastResults","errors","warnings","success","contrast","parseRgb","css","i","m","rgb","_i","_j","match","slice","contrastRatio","x","y","l1","relativeLuminance","l2","Math","max","min","c","lum","v","push","pow","getBackground","el","styles","getComputedStyle","bgColor","backgroundColor","bgImage","backgroundImage","tagName","parentNode","isVisible","offsetWidth","offsetHeight","getClientRects","length","check","checkElement","elements","querySelectorAll","n","elem","style","color","fill","htmlTag","background","textString","reduce","call","childNodes","a","b","nodeType","textContent","text","trim","ratingString","fontSizeString","failed","ratio","round","ratioText","fontSize","parseInt","fontWeight","error","name","detail","status","init","each","element","item","append"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery'\n],\nfunction(\n    $\n) {\n\n    var contrastResults = {\n        errors: [],\n        warnings: [],\n        success: []\n    };\n    var contrast = {\n        // Parse rgb(r, g, b) and rgba(r, g, b, a) strings into an array.\n        // Adapted from https://github.com/gka/chroma.js\n        parseRgb: function (css) {\n            var i, m, rgb, _i, _j;\n            m = css.match(/rgb\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*\\)/);\n            if (m) {\n                rgb = m.slice(1, 4);\n                for (i = _i = 0; _i <= 2; i = ++_i) {\n                    rgb[i] = +rgb[i];\n                }\n                rgb[3] = 1;\n            } else {\n                m = css.match(/rgba\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)/);\n                if (m) {\n                    rgb = m.slice(1, 5);\n                    for (i = _j = 0; _j <= 3; i = ++_j) {\n                        rgb[i] = +rgb[i];\n                    }\n                }\n            }\n            return rgb;\n        },\n        // Based on http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n        contrastRatio: function (x, y) {\n            var l1 = contrast.relativeLuminance(contrast.parseRgb(x));\n            var l2 = contrast.relativeLuminance(contrast.parseRgb(y));\n            return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);\n        },\n        // Based on http://www.w3.org/TR/WCAG20/#relativeluminancedef\n        relativeLuminance: function (c) {\n            var lum = [];\n            for (var i = 0; i < 3; i++) {\n                var v = c[i] / 255;\n                lum.push(v < 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4));\n            }\n            return 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n        },\n        getBackground: function (el) {\n\n            var styles = getComputedStyle(el),\n                bgColor = styles.backgroundColor,\n                bgImage = styles.backgroundImage;\n\n            if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent' && bgImage === \"none\") {\n                return bgColor;\n            } else if (bgImage !== \"none\") {\n                return \"image\";\n            }\n\n            if (el.tagName === 'HTML') {\n                return 'rgb(255, 255, 255)';\n            } else {\n                return contrast.getBackground(el.parentNode);\n            }\n        },\n        // check visibility - based on jQuery method\n        isVisible: function (el) {\n            return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n        },\n        check: function (checkElement) {\n            var elements = checkElement.querySelectorAll('*');\n            for (var i = 0; i < elements.length; i++) {\n                (function (n) {\n                    var elem = elements[n];\n                    // test if visible\n                    //if (contrast.isVisible(elem)) {\n                        var style = getComputedStyle(elem),\n                            color = style.color,\n                            fill = style.fill,\n                            htmlTag = elem.tagName,\n                            background = contrast.getBackground(elem),\n                            textString = [].reduce.call(elem.childNodes, function (a, b) {\n                                return a + (b.nodeType === 3 ? b.textContent : '');\n                            }, ''),\n                            text = textString.trim(),\n                            ratingString,\n                            fontSizeString,\n                            failed;\n\n                        if (htmlTag === \"svg\") {\n                           var  ratio = Math.round(contrast.contrastRatio(fill, background) * 100) / 100,\n                                ratioText = ratio + ':1';\n                            if(ratio < 3) {\n                                failed=\"true\";\n                                fontSizeString = \"svg fill\";\n                                ratingString = \"fail\";\n                            }\n                        } else if (text.length) {\n                            // does element have a background image - needs to be manually reviewed\n                            if (background === \"image\") {\n                                ratingString = \"Needs manual review\";\n                                fontSizeString = \"N/A\";\n                                var ratio = 'none';\n                                failed = true;\n                            } else {\n                                var ratio = Math.round(contrast.contrastRatio(color, background) * 100) / 100,\n                                    ratioText = ratio + ':1',\n                                    fontSize = parseInt(style.fontSize),\n                                    fontWeight = style.fontWeight;\n                                if (fontSize >= 18 || fontSize >= 14 && fontWeight >= 700) {\n                                    fontSizeString = 'large scale text';\n                                    if (ratio < 3) {\n                                        ratingString = 'fail';\n                                        failed = true;\n                                    } else {\n                                        ratingString = 'pass';\n                                        failed = false;\n                                    }\n                                } else {\n                                    fontSizeString = 'normal body text';\n                                    if (ratio < 4.5) {\n                                        ratingString = 'fail';\n                                        failed = true;\n                                    } else {\n                                        ratingString = 'pass';\n                                        failed = false;\n                                    }\n                                }\n                            }\n                        } else {\n                            return '';\n                        }\n\n                        // highlight the element in the DOM and log the element, contrast ratio and failure\n                        // for testing in console\n                        if (failed) {\n                            var error = {};\n                            error = {\n                                name: elem,\n                                ratio: ratioText,\n                                detail: fontSizeString,\n                                status: ratingString\n                            };\n                            if(ratingString === \"fail\"){\n                                contrastResults.errors.push(error);\n                            } else if (ratingString === \"Needs manual review\"){\n                                contrastResults.warnings.push(error);\n                            }\n                        } else {\n                            var success = {\n                                name: elem,\n                                ratio: ratioText,\n                                detail: fontSizeString,\n                                status: ratingString\n                            };\n                            contrastResults.success.push(success);\n                        }\n                    //}\n                })(i);\n            }\n            return contrastResults;\n        }\n    };\n\n    /**\n     * Run the contrast checker on selected page elements\n     *\n     * @param {object} root The root element for the overview block.\n     */\n    var init = function() {\n        $('[data-action=\"contrastcheck\"]').each(function() {\n            var element = $(this)[0];\n            contrast.check(element);\n            for (var i = 0; i < contrastResults.errors.length; i++) {\n                var item = contrastResults.errors[i];\n                $(item.name).append('<span class=\"badge badge-danger border border-dark m-1\">' + item.ratio + '</span>');\n            }\n\n            for (var i = 0; i < contrastResults.warnings.length; i++) {\n                var item = contrastResults.warnings[i];\n                $(item.name).append('<span class=\"badge badge-warning border border-dark m-1\">' + item.ratio + '</span>');\n            }\n\n            for (var i = 0; i < contrastResults.success.length; i++) {\n                var item = contrastResults.success[i];\n                $(item.name).append('<span class=\"badge badge-success border border-dark m-1\">' + item.ratio + '</span>');\n            }\n            contrastResults.errors = [];\n            contrastResults.warnings = [];\n            contrastResults.success = [];\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"checkcontrast.min.js"}
{"version":3,"sources":["../src/search.js"],"names":["define","$","lunr","Log","lunrIndex","$results","pagesIndex","initLunr","jsonFile","getJSON","done","index","field","boost","ref","forEach","page","add","bind","fail","jqxhr","textStatus","error","debug","initUI","keyup","empty","query","val","length","results","search","renderResults","map","result","filter","uri","html","baseUrl","M","cfg","wwwroot","slice","$result","append","class","href","text","title","addClass","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Interface to the Lunr search engines.\n *\n * @module     tool_componentlibrary/search\n * @package    tool_componentlibrary\n * @copyright  2020 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'tool_componentlibrary/lunr', 'core/log'],\n\nfunction($, lunr, Log) {\n\n    var lunrIndex,\n        $results,\n        pagesIndex;\n\n    // Initialize lunrjs using our generated index file\n    function initLunr(jsonFile) {\n        // First retrieve the index file\n        $.getJSON(jsonFile)\n            .done(function(index) {\n                pagesIndex = index;\n                // Set up lunrjs by declaring the fields we use\n                // Also provide their boost level for the ranking\n                lunrIndex = lunr(function() {\n                    this.field(\"title\", {\n                        boost: 10\n                    });\n                    this.field(\"tags\", {\n                        boost: 5\n                    });\n                    this.field(\"content\");\n\n                    // ref is the result item identifier (I chose the page URL)\n                    this.ref(\"uri\");\n\n                    pagesIndex.forEach(function(page) {\n                        this.add(page);\n                    }.bind(this));\n                });\n                // Feed lunr with each file and let lunr actually index them\n\n            })\n            .fail(function(jqxhr, textStatus, error) {\n                Log.debug(\"Error getting Hugo index file:\" + textStatus + \", \" + error);\n            });\n    }\n\n    // Nothing crazy here, just hook up a listener on the input field\n    function initUI() {\n        $results = $('[data-region=\"docsearch\"] input');\n        $('[data-region=\"docsearch\"] input').keyup(function() {\n            $results.empty();\n\n            // Only trigger a search when 2 chars. at least have been provided\n            var query = $(this).val();\n            if (query.length < 2) {\n                return;\n            }\n\n            var results = search(query);\n\n            renderResults(results);\n        });\n    }\n\n    /**\n     * Trigger a search in lunr and transform the result\n     *\n     * @param  {String} query\n     * @return {Array}  results\n     */\n    function search(query) {\n        // Find the item in our index corresponding to the lunr one to have more info\n        // Lunr result:\n        //  {ref: \"/section/page1\", score: 0.2725657778206127}\n        // Our result:\n        //  {title:\"Page1\", href:\"/section/page1\", ...}\n        return lunrIndex.search(query).map(function(result) {\n            return pagesIndex.filter(function(page) {\n                return page.uri === result.ref;\n            })[0];\n        });\n    }\n\n    /**\n     * Display the 10 first results\n     *\n     * @param  {Array} results to display\n     */\n    function renderResults(results) {\n        if (!results.length) {\n            return;\n        }\n\n        // Clear out the results.\n        $('[data-region=\"docsearch\"] .dropdown-menu').html(' ');\n\n        var baseUrl = M.cfg.wwwroot + '/admin/tool/componentlibrary/docspage.php';\n        // Only show the ten first results\n        results.slice(0, 10).forEach(function(result) {\n            var $result = $(\"<li>\");\n            $result.append($(\"<a>\", {\n                class: 'dropdown-item',\n                href: baseUrl + result.uri,\n                text: result.title\n            }));\n            $('[data-region=\"docsearch\"] .dropdown-menu').append($result);\n        });\n        $('[data-region=\"docsearch\"] .dropdown-menu').addClass('show');\n        $('[data-region=\"docsearch\"]').addClass('show');\n    }\n\n    function init(jsonFile) {\n        initLunr(jsonFile);\n        initUI();\n    }\n\n    // This module does not expose anything.\n    return {\n        init: init\n    };\n});\n"],"file":"search.min.js"}